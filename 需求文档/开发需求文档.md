# 股票自动交易系统开发需求文档

## 1. 项目概述

### 1.1 项目目标
开发一个基于Level2行情数据的股票自动交易系统，通过多个股票池策略实现智能化买入决策。

### 1.2 核心功能
- 基于历史数据的股票评分系统
- 多策略股票池筛选机制
- 实时行情监控与自动买入
- 可配置参数的策略调整
- 卖出策略集成

## 2. 功能需求

### 2.1 股票评分系统（昨日数据分析）

#### 2.1.1 涨停炸板评分
- **条件**: 昨日涨停炸板，收盘未封板
- **计算公式**: `|（最高价-收盘价）/前一日收盘价|` 作为赋值X1%
- **配置要求**: X1%值可快捷调整

#### 2.1.2 跌幅评分
- **条件**: 昨日收盘涨幅小于-2%
- **计算公式**: `|（最高价-收盘价）/前一日收盘价|` 作为赋值X2%
- **配置要求**: X2%值可快捷调整

#### 2.1.3 涨停封单评分
- **条件**: 昨日收盘涨停，涨停封单小于X000万
- **赋值**: 2X%
- **配置要求**: 封单金额阈值可调整

#### 2.1.4 涨停时间评分
- **条件1**: 涨停时间在11:00-14:00，赋值3X%
- **条件2**: 涨停时间在14:00后，赋值5X%
- **配置要求**: 时间段和赋值可调整

#### 2.1.5 连续跌幅评分
- **条件**: 昨日收盘涨幅小于-2X% AND 前日收盘涨幅小于-2X%
- **计算公式**: `|（前日最高价-昨日收盘价）/前一日收盘价|` 作为赋值X3%
- **配置要求**: 跌幅阈值和X3%值可调整

#### 2.1.6 涨停炸板回封评分
- **条件**: 昨日收盘涨停 AND 涨停炸板又回封超过5次
- **赋值**: 5X%
- **配置要求**: 回封次数阈值可调整

### 2.2 股票池A策略

#### 2.2.1 筛选条件
- **A**: 实际流通市值 >= X0亿 且 < X00亿
- **B**: 竞价成交额 > X000万
- **C**: 开盘换手 > 0.2X%
- **D**: 个股竞价涨幅 > -2X%（竞价时计算）
- **E**: 今日竞价成交金额/昨日成交额*100% >= X%
- **F**: 板块指数 > X% OR 同板块涨幅 > X的个股 > 2个

#### 2.2.2 逻辑关系
```
A AND B AND C AND D AND E
```

#### 2.2.3 买入策略
1. **基础买入**: 满足条件的个股按A+M排名前5个股竞价买入0.1成
2. **突破买入**: 涨幅大于昨日最高价/前日最高价 AND 当时分钟成交额大于昨日最大分钟成交额，买入0.05成
3. **主力资金买入条件**:
   - 主力净额 > X000万 AND 主力净比 > 0.5X% AND 涨幅 > 1X%，买入0.05X%
   - 主力净额 > X000万 AND 主力净比 > 0.5% AND 涨幅 > 2X%，买入0.05X%
   - 主力净额 > X0000万 AND 主力净比 > 0.5X% AND 涨幅 > 7% AND 当前成交额 > 3亿 AND 实际换手率 > 1%，买入0.1成

#### 2.2.4 涨停价买入策略
- **主板股票**: 涨幅 >= 8X% AND 逐笔委托数 > 5X000手的单子累积委托数 > 1X万手，按涨停价买入0.1X成
- **创业板股票**: 涨幅 >= 18% AND 逐笔委托数 > 52X00手的单子累积委托数 > 8X00手，按涨停价买入

### 2.3 股票池B策略

#### 2.3.1 筛选条件
- **A**: 满足昨日评分条件（1-6）AND 今日竞价涨幅+昨日赋值的和取前X20
- **B**: 实际流通市值 >= 5X亿 且 < 4X0亿
- **C**: 竞价成交额 > X00万
- **D**: 开盘换手 > 0.2X%
- **E**: 个股竞价涨幅 > -2X%
- **F**: 今日竞价成交金额/昨日成交额*100% >= X%
- **G**: 板块指数 > X% OR 同板块涨幅 > X的个股 > 2个

#### 2.3.2 逻辑关系
```
A AND B AND C AND D AND E
```

#### 2.3.3 买入策略
与股票池A相同的买入策略

### 2.4 股票池ZB策略（补充策略）

#### 2.4.1 入池条件
- 竞价涨停 AND 封单 > 3X00万 AND 涨停炸板后放入ZB池子
- 根据实际流通大小分为ZB-A和ZB-B

#### 2.4.2 股票池ZB-A
- **A**: 实际流通市值 >= 40X亿 且 < 500X亿
- **B**: 主力净额 > x000万 AND 主力净比 > 0.5% AND 涨幅 > 7X% AND 当前成交额 > 3X亿 AND 实际换手率 > 1X%，买入0.X1成
- **C**: 主板股票涨幅 >= 8% AND 逐笔委托数 > 5000手的单子累积委托数 > 1万手，按涨停价买入0.1成
- **D**: 创业板股票涨幅 >= 18% AND 逐笔委托数 > 2500手的单子累积委托数 > 8000手，按涨停价买入

**逻辑关系**: `A AND B AND (C OR D)`

#### 2.4.3 股票池ZB-B
- **A**: 实际流通市值 >= 5X亿 且 < 4X0亿
- **B**: 主力净额 > 5x000万 AND 主力净比 > 0.5X% AND 涨幅 > 7X% AND 当前成交额 > 3X亿 AND 实际换手率 > 1X%，买入0.X1成
- **C**: 主板股票涨幅 >= 8X% AND 逐笔委托数 > 5000手的单子累积委托数 > 1X万手，按涨停价买入0.1X成
- **D**: 创业板股票涨幅 >= 18% AND 逐笔委托数 > 25X0手的单子累积委托数 > 8X00手，按涨停价买入

**逻辑关系**: `A AND (B AND (C OR D))`

## 3. 技术需求

### 3.1 数据源要求
- **Level2行情数据**: 实时逐笔委托、成交数据
- **基础行情数据**: 开盘价、收盘价、最高价、最低价、成交量、成交额
- **历史数据**: 前一日、前两日的完整交易数据
- **板块数据**: 板块指数、板块内个股数据

### 3.2 关键指标定义

#### 3.2.1 主力净额
- **定义**: 需要基于Level2行情数据计算
- **计算方法**: 待具体定义（大单净流入金额）
- **数据来源**: Level2逐笔成交数据

#### 3.2.2 主力净比
- **定义**: 主力净额占总成交额的比例
- **计算公式**: `主力净额 / 总成交额 * 100%`

#### 3.2.3 实际换手率
- **计算公式**: `成交量 / 实际流通股本 * 100%`

#### 3.2.4 竞价涨幅
- **计算公式**: `(竞价价格 - 昨日收盘价) / 昨日收盘价 * 100%`

### 3.3 系统架构要求
- **实时数据处理**: 支持Level2行情数据的实时接收和处理
- **策略引擎**: 支持多策略并行执行
- **风控模块**: 资金管理和风险控制
- **配置管理**: 所有参数可动态调整
- **交易接口**: 支持自动下单功能

## 4. 数据模型

### 4.1 股票基础信息
```python
class StockInfo:
    code: str              # 股票代码
    name: str              # 股票名称
    market: str            # 市场类型（主板/创业板）
    circulation_value: float  # 实际流通市值（亿）
    circulation_shares: float # 实际流通股本
```

### 4.2 历史评分数据
```python
class HistoricalScore:
    stock_code: str        # 股票代码
    date: str             # 日期
    score_type: str       # 评分类型
    score_value: float    # 评分值
    calculation_detail: dict # 计算详情
```

### 4.3 实时行情数据
```python
class RealtimeQuote:
    stock_code: str       # 股票代码
    timestamp: datetime   # 时间戳
    price: float         # 当前价格
    volume: int          # 成交量
    amount: float        # 成交额
    turnover_rate: float # 换手率
    price_change_pct: float # 涨跌幅
```

### 4.4 Level2数据
```python
class Level2Data:
    stock_code: str       # 股票代码
    timestamp: datetime   # 时间戳
    bid_orders: list     # 买单队列
    ask_orders: list     # 卖单队列
    transactions: list   # 逐笔成交
    order_queue: list    # 委托队列
```

## 5. API规范

### 5.1 股票池查询接口
```python
def get_stock_pool(pool_type: str, date: str = None) -> List[StockInfo]:
    """
    获取指定类型的股票池
    
    Args:
        pool_type: 股票池类型 ('A', 'B', 'ZB-A', 'ZB-B')
        date: 查询日期，默认为当前日期
    
    Returns:
        符合条件的股票列表
    """
    pass
```

### 5.2 历史评分计算接口
```python
def calculate_historical_score(stock_code: str, date: str) -> float:
    """
    计算指定股票的历史评分
    
    Args:
        stock_code: 股票代码
        date: 计算日期
    
    Returns:
        历史评分值
    """
    pass
```

### 5.3 买入信号检测接口
```python
def check_buy_signal(stock_code: str, pool_type: str) -> dict:
    """
    检测买入信号
    
    Args:
        stock_code: 股票代码
        pool_type: 股票池类型
    
    Returns:
        买入信号详情，包括信号类型、买入数量等
    """
    pass
```

## 6. 实现指导

### 6.1 开发优先级
1. **第一阶段**: 历史数据评分系统
2. **第二阶段**: 股票池A和B的筛选逻辑
3. **第三阶段**: 实时买入策略实现
4. **第四阶段**: 股票池ZB策略
5. **第五阶段**: 卖出策略集成

### 6.2 关键技术点
- Level2数据解析和处理
- 实时计算引擎设计
- 多策略并行执行
- 参数配置热更新
- 交易风控机制

### 6.3 性能要求
- 实时数据处理延迟 < 100ms
- 策略计算响应时间 < 50ms
- 支持同时监控1000+股票
- 系统可用性 > 99.9%

## 7. 验收标准

### 7.1 功能验收
- [ ] 历史评分计算准确性验证
- [ ] 股票池筛选逻辑正确性验证
- [ ] 买入信号触发准确性验证
- [ ] 参数配置功能完整性验证
- [ ] 实时数据处理稳定性验证

### 7.2 性能验收
- [ ] 实时数据处理性能达标
- [ ] 策略计算性能达标
- [ ] 系统并发处理能力达标
- [ ] 内存使用效率达标

### 7.3 集成验收
- [ ] Level2数据接口集成测试
- [ ] 交易接口集成测试
- [ ] 数据库集成测试
- [ ] 监控告警集成测试

## 8. 配置管理

### 8.1 可配置参数列表
所有涉及数值的参数都需要支持快捷调整，包括但不限于：

- 各类评分的赋值比例（X1%, X2%, X3%等）
- 市值筛选范围
- 成交额阈值
- 换手率阈值
- 涨跌幅阈值
- 主力资金阈值
- 买入时间控制
- 买入数量配置

### 8.2 配置界面要求
- 提供图形化配置界面
- 支持参数实时生效
- 提供参数历史版本管理
- 支持参数模板保存和加载

## 9. 风险控制

### 9.1 资金管理
- 单股最大持仓比例限制
- 总持仓资金比例控制
- 日内最大交易次数限制

### 9.2 异常处理
- 数据异常检测和处理
- 网络连接异常恢复
- 交易接口异常处理
- 系统故障自动恢复

## 10. 扩展性考虑

### 10.1 策略扩展
- 支持新增自定义策略
- 支持策略参数动态调整
- 支持策略组合和权重配置

### 10.2 数据源扩展
- 支持多数据源接入
- 支持数据源切换和备份
- 支持新数据类型集成

---

**注意事项**：
1. 文档中的X、X0、X00等占位符需要在实际开发中确定具体数值
2. 主力净额的具体计算方法需要进一步明确定义
3. 卖出策略和买入策略的搬运需要根据实际情况评估工作量
4. 所有涉及实盘交易的功能都需要充分的测试和风控措施
